<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="mapper.community">

	<resultMap type="communityVO" id="communityResult">
		<result property="board_num" column="board_num"/>
		<result property="board_title" column="board_title"/>
		<result property="board_genre" column="board_genre"/>
		<result property="board_like" column="board_like"/>
		<result property="board_date" column="board_date"/>
		<result property="nickname" column="nickname"/>
	</resultMap>
	
	<select id="community_list_view" resultMap="communityResult">
		<![CDATA[
			select board_num, board_title, board_genre, 
			(SELECT NVL(count(*),0) FROM liketbl WHERE board_num=b.board_num) as board_like,  
			board_date, j.nickname  
			from boardtbl b, jointbl j where b.id=j.id 
			order by board_num desc
		]]>
	</select>
	
	<select id="two_best_community_list" resultMap="communityResult">
		<![CDATA[
			SELECT * FROM (select board_num, board_title, board_genre, 
			(SELECT NVL(count(*),0) FROM liketbl WHERE board_num=b.board_num) as board_like, 
			board_date, j.nickname 
			from boardtbl b, jointbl j where b.id=j.id order by board_like desc, board_view desc) A WHERE not board_like=0 and rownum<=2
		]]>
	</select>
	
	<select id="max_num" resultType="_int">
		<![CDATA[
			SELECT count(*) as max from boardtbl
		]]>
	</select>
	
	<insert id="addArticle" parameterType="communityVO">
		<![CDATA[
			INSERT INTO boardtbl(board_num, board_title, id, board_view, board_genre, board_content) 
			VALUES((SELECT NVL(MAX(board_num),0)+1 FROM boardtbl), #{board_title}, #{id}, 0, #{board_genre}, #{board_content})
		]]>
	</insert>
	
	<select id="viewArticle" resultType="communityVO" parameterType="int">
		<![CDATA[
			SELECT * FROM boardtbl WHERE board_num=#{board_num}
		]]>
	</select>
	
	<update id="updateBoardView" parameterType="int">
		<![CDATA[
			UPDATE boardtbl SET board_view=board_view+1 WHERE board_num=#{board_num}
		]]>
	</update>
	
	<select id="getNickname" resultType="String" parameterType="String">
		<![CDATA[
			SELECT nickname FROM jointbl WHERE id=#{id}
		]]>
	</select>
	
	<select id="likeIs" resultType="String" parameterType="communityVO">
		<![CDATA[
			SELECT DECODE(count(*), 1, 'true', 'false') 
			AS RESULT FROM liketbl 
			WHERE id=#{id} and board_num=#{board_num}
		]]>
	</select>
	
	<select id="getBoardLike" resultType="_int" parameterType="int">
		<![CDATA[
			SELECT NVL(count(*),0) AS board_like FROM liketbl WHERE board_num=#{board_num}
		]]>
	</select>
	
	<insert id="addLike" parameterType="communityVO">
		<![CDATA[
			INSERT INTO liketbl (id, board_num) 
			VALUES(#{id}, #{board_num})
		]]>
	</insert>
	
	<delete id="delLike" parameterType="communityVO">
		<![CDATA[
			DELETE FROM liketbl WHERE id=#{id} AND board_num=#{board_num}
		]]>
	</delete>
	
</mapper>